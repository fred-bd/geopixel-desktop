include (BundleUtilities) 

set(GEOPIXELDESKTOP_BUILD_AS_BUNDLE @GEOPIXELDESKTOP_BUILD_AS_BUNDLE@)
set(Qt5_DIR @Qt5_DIR@)

file (GLOB_RECURSE GEOPIXELDESKTOP_PLGS ${CMAKE_INSTALL_PREFIX}/*@CMAKE_SHARED_LIBRARY_SUFFIX@)

if(WIN32)

  set(GEOPIXELDESKTOP_APPLICATION ${CMAKE_INSTALL_PREFIX}/bin/geopixeldesktop.exe)
  set(GEOPIXELDESKTOP_PATHS "")

  set(GEOPIXELDESKTOP_PATHS "@_TEBIN@;@Qt5_DIR@/../../../bin;@CMAKE_PREFIX_PATH@/lib")

endif()

# Call fixup_bundle
fixup_bundle("${GEOPIXELDESKTOP_APPLICATION}" "${GEOPIXELDESKTOP_PLGS}" "${GEOPIXELDESKTOP_PATHS}")

if(Qt5_DIR AND GEOPIXELDESKTOP_BUILD_AS_BUNDLE)

  if(WIN32)
    set(GEOPIXELDESKTOP_QT_ASSISTANT_SRC_PATH ${Qt5_DIR}/../../../bin/assistant.exe)
    set(GEOPIXELDESKTOP_QT_ASSISTANT_TARGET_DIR ${CMAKE_INSTALL_PREFIX}/bin)
    set(GEOPIXELDESKTOP_QT_ASSISTANT_TARGET_PATH ${GEOPIXELDESKTOP_QT_ASSISTANT_TARGET_DIR}/assistant.exe)
    EXECUTE_PROCESS(COMMAND ${CMAKE_COMMAND} -E copy "${GEOPIXELDESKTOP_QT_ASSISTANT_SRC_PATH}"
                                                     "${GEOPIXELDESKTOP_QT_ASSISTANT_TARGET_DIR}")
  endif()

  fixup_bundle("${GEOPIXELDESKTOP_QT_ASSISTANT_TARGET_PATH}" "" "${GEOPIXELDESKTOP_PATHS}")
endif()
